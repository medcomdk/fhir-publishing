name: MedCom publish job

on:
  workflow_call:
  inputs:
    IG_PUBLISHER_VERSION:
      description: With this you can override what version of the publisher should be used
      required: false
      default: 'NONE'
      type: string

jobs:
  qa-report-status:
    name: "Comments the status of the QA report on the PR"
    runs-on: ubuntu-latest
    container: ghcr.io/trifork/ig-publisher:1.8.26

    steps:
    - name: Comment on PR
      uses: actions/github-script@v7
      with:
        script: |
          const titleOfComment = "## QA Report status"
          const body = titleOfComment + "\nTest"

          const { owner, repo } = context.repo;
          const prNumber = context.payload.pull_request.number;

          const existing = await github.paginate(
            github.rest.issues.listComments,
            { owner, repo, issue_number: prNumber },
          );

          const ourComment = existing.find(c =>
            c.user.type === 'Bot' &&
            c.body.includes(titleOfComment)
          );

          if (ourComment) {
            await github.rest.issues.updateComment({ owner, repo, comment_id: ourComment.id, body });
          } else {
            await github.rest.issues.createComment({ owner, repo, issue_number: prNumber, body });
          }